<!doctype html>
<html lang="en">

<head>

	<!--Standard meta parameters-->
	<meta charset="utf-8">

	<!--Standard script imports-->
	<script src="../lib/d3.min.js"></script>
	<script src="script_visu.js"></script>

	<!--Page title and authors-->
	<title>International Football</title>
	<meta name="author" content="Alexandre Reynaud, Léo Bouraux, Vincent Rinaldi">

	<!--Standard style imports-->
	<link rel="stylesheet" href="style_visu.css">

	<!--Slider imports-->
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

	<!--Slider script-->
	<script>
		$( function() {
			$( "#slider-range" ).slider({
				range: true,
				min: 1872,
				max: 2020,
				values: [ 1872, 2020 ],
				slide: function( event, ui ) {
					$( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
					$( "#slider_text" ).html(ui.values[ 0 ]+" - "+ui.values[ 1 ]);
				}
			});
			$( "#amount" ).val( "$" + $( "#slider-range" ).slider( "values", 0 ) +
					" - $" + $( "#slider-range" ).slider( "values", 1 ) );
		} );
	</script>

	<!--Importing Leaflet-->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
	<style type="text/css">
		.leaflet-container{background-color:var(--background);}
	</style>

	<!--Choropleth map scripts-->
	<script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script>
	<script>

		//Assigns a color to the inputed value
		function getColor(d) {
			return "red"
		}

		//Runs when hovering over a country
		function onHover(layer) {

			//Putting the tile in evidence
			layer.setStyle({
				weight: 2,
				fillOpacity: 0.9,
				dashArray: ''
			});

			if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
				layer.bringToFront();
			}

			//Putting the corresponding flag in evidence
			flag=	document.getElementById(layer.feature.properties.name);

			if (flag!=null) {
				flag.style.opacity=0;
				flag.style.background="none";
				flag.style.border="none";

			}

			//Printing the name and value of the country from the hover display box
			let p1 = document.createElement("p");
			let p2 = document.createElement("small");
			p1.appendChild(document.createTextNode(layer.feature.properties.name));
			p2.appendChild(document.createTextNode(layer.feature.properties.name));
			document.getElementById("map_hover").appendChild(p1);
			document.getElementById("map_hover").appendChild(p2);
		}

		//Runs when a country stops being hovered over
		function onHoverEnd(layer) {

			//Deactivates the hovered country's targetting
			if (!layer.clicked){
				geojson.resetStyle(layer);
			}

			//Removes the data of the hovered country from the hover display box
			document.getElementById("map_hover").innerHTML=""

			//Putting the corresponding flag in evidence
			flag=document.getElementById(layer.feature.properties.name);

			if (flag!=null && !layer.clicked) {
				flag.style="resetStyle";
			}

		}

		//Runs when clicking on a country
		function select(layer) {

			//Activating or deactivating the clicked state
			layer.clicked=!layer.clicked

			if (layer.clicked) {
				//Adding the name and value of the country from the select box
				let p = document.createElement("small");
				p.style.display="block";
				p.style.textAlign = "left";
				p.id=layer.feature.properties.name+"_display";
				p.appendChild(document.createTextNode(layer.feature.properties.name+" → "+layer.feature.properties.name));
				document.getElementById("map_select").appendChild(p);
			} else {
				//Removing the name and value of the country from the select box
				let p=document.getElementById(layer.feature.properties.name+"_display");
				p.parentNode.removeChild(p);
			}

		}

		//Assigning onHover, onHoverEnd and select to the tiles
		function onEachFeature(feature, layer) {
			layer.clicked = false;
			flag=document.getElementById(feature.properties.name)

			if(flag!=null){
				flag.addEventListener("click", function(e){
					select(layer);
				});
				flag.addEventListener("mouseover", function(e){
					onHoverEnd(layer);
				});
				flag.addEventListener("mouseout", function(e){
					onHover(layer);
				});
			}
			layer.on({
				mouseover: function(e){onHover(e.target)},
				mouseout:  function(e){onHoverEnd(e.target)},
				click:  function(e){select(e.target)}
			});
		}

		//Assigns visual characteristics to the input tile (ex: color)
		function style(feature) {

			return {
				fillColor: getColor(feature.properties.name),
				weight: 1,
				opacity: 1,
				color: 'black',
				dashArray: '3',
				fillOpacity: 0.7
			};
		}

		//Loads the tiles and sets-up the map
		$.ajaxSetup({beforeSend: function(xhr){
				if (xhr.overrideMimeType)
				{
					xhr.overrideMimeType("application/json");
				}
			}
		});

		$.getJSON("map_processed.json",function(data){

			let map = L.map('map',{minZoom:1}).setView([50, 0], 3);
			geojson=L.geoJson(data, {
				style: style,
				onEachFeature: onEachFeature
			}).addTo(map);
		})


	</script>

</head>
<body>

<!--Choropleth map container-->
<div id="map" style="width: 99vw; height: 75vh;"></div>

<!--Choropleth map data containers-->
<div id="map_hover"></div>
<div id="map_select">
	<p style="margin-top:3px;line-height: 0;">SUMMARY</p>
</div>


<!--Visualization switching buttons-->
<div id="btns">
	<div class="btn-style-div" id="history-button" onclick="change_tab('HISTORY')">
		<p style="flex: 0 0 120px;">History</p>
	</div>

	<div class="btn-style-div" id="details-button" onclick="change_tab('DETAILS')">
		<p style="flex: 0 0 120px;">Details</p>
	</div>
</div>

<!--Comparison criterion radio boxes-->
<form id="measure_container">
	<p>MEASURE</p>
</form>

<!--Comparison competition radio boxes-->
<form id="competition_container">
	<p>COMPETITION</p>
</form>

<!--Visualization title (map excluded)-->

<!--Time slider-->
<div id="slider_container">
	<div id="slider-range"></div>
	<div style="font-size:1vw;" id="slider_text">1872 - 2020</div>
</div>

<!--Flag slider-->
<div class="flag-slider" id="js_flag_scroll"></div>
<div class="wrap-input100" id="anim-map-input">
	<input class="input100" type="text" id="search_bar" oninput="input_listener()" placeholder="Search for a country...">
	<span class="focus-input100"></span>
</div>

<!--Guideline bubble -->
<div class="guideline_container">
</div>
<div class="anim-text">
	Choose a criterion, different competition(s)
</div>
<div class="anim-text" style="animation-delay: 5s">
	and a time range to display the data.
</div>



</body>
</html>

