<!doctype html>
<html lang="en">

<head>

	<!--Standard meta parameters-->
	<meta charset="utf-8">

	<!--Standard script imports-->
	<script src="../lib/d3.min.js"></script>
	<script src="script_visu.js"></script>

	<!--Page title and authors-->
	<title>International Football</title>
	<meta name="author" content="Alexandre Reynaud, LÃ©o Bouraux, Vincent Rinaldi">

	<!--Standard style imports-->
	<link rel="stylesheet" href="style_visu.css">

	<!--Slider imports-->
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

	<!--Slider script-->
	<script>
		$( function() {
			$( "#slider-range" ).slider({
				range: true,
				min: 1872,
				max: 2020,
				values: [ 1872, 2020 ],
				slide: function( event, ui ) {
					$( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
					$( "#slider_text" ).html(ui.values[ 0 ]+" - "+ui.values[ 1 ]);
				}
			});
			$( "#amount" ).val( "$" + $( "#slider-range" ).slider( "values", 0 ) +
					" - $" + $( "#slider-range" ).slider( "values", 1 ) );
		} );
	</script>

	<!--Importing Leaflet-->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
	<style type="text/css">
			.leaflet-container{background-color:#c5e8ff;}
	</style>

	<!--Choropleth map scripts-->
	<script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script>
	<script>

		//Assigns a color to the inputed value
		function getColor(d) {
				return "red"
		}

		//Runs when hovering over a country
		function onHover(e) {

				let layer=e.target

				//Putting the tile in evidence
				layer.setStyle({
						weight: 2,
						fillOpacity: 0.9,
						dashArray: ''
				});

				if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
						layer.bringToFront();
				}

				//Putting the corresponding flag in evidence
				flag=	document.getElementById(layer.feature.properties.name);

				if (flag!=null) {
						flag.style.opacity=0;
						flag.style.background="none";
						flag.style.border="none";

				}

				//Printing the name and value of the country from the hover display box
				let p = document.createElement("p");
				p.style.fontSize="2vh";
	    	p.appendChild(document.createTextNode(layer.feature.properties.name+" --> "+layer.feature.properties.name));
	    	document.getElementById("map_hover").appendChild(p);
		}

		//Runs when a country stops being hovered over
		function onHoverEnd(e) {

			//Getting the element for which the hover ended
			let layer=e.target;

			//Deactivates the hovered country's targetting
			if (!layer.clicked){
				geojson.resetStyle(layer);
			}

			//Removes the data of the hovered country from the hover display box
			document.getElementById("map_hover").innerHTML=""

			//Putting the corresponding flag in evidence
			flag=	document.getElementById(layer.feature.properties.name);

			if (flag!=null && !layer.clicked) {
					flag.style="resetStyle";


			}

		}

		//Runs when clicking on a country
		function select(e) {

			//Getting the selected element
			let layer = e.target;

			//Activating or deactivating the clicked state
			layer.clicked=!layer.clicked


			if (layer.clicked) {

			//Adding the name and value of the country from the select box
			let p = document.createElement("p");
			p.id=layer.feature.properties.name+"_display";
			p.style.fontSize="2vh";
    	p.appendChild(document.createTextNode(layer.feature.properties.name+" --> "+layer.feature.properties.name));
    	document.getElementById("map_select").appendChild(p);

		} else {

			//Removing the name and value of the country from the select box
			let p=document.getElementById(layer.feature.properties.name+"_display");
			p.parentNode.removeChild(p);
		}

		}

		//Assigning onHover, onHoverEnd and select to the tiles
		function onEachFeature(feature, layer) {
				layer.clicked = false;
				layer.on({
						mouseover: onHover,
						mouseout:  onHoverEnd,
						click:  select
				});
		}

		//Assigns visual characteristics to the input tile (ex: color)
		function style(feature) {

			return {
					fillColor: getColor(feature.properties.name),
					weight: 1,
					opacity: 1,
					color: 'black',
					dashArray: '3',
					fillOpacity: 0.7
			};
		}

		//Loads the tiles and sets-up the map
		$.ajaxSetup({beforeSend: function(xhr){
				if (xhr.overrideMimeType)
				{
					xhr.overrideMimeType("application/json");
				}
			}
		});

		$.getJSON("choropleth.json",function(data){
		//$.getJSON("choropleth.json",function(data){
			let map = L.map('map',{minZoom:1}).setView([50, 0], 3);
				geojson=L.geoJson(data, {
					style: style,
					onEachFeature: onEachFeature
				}).addTo(map);
		})


	</script>

</head>
<body>

	<!--Choropleth map container-->
  <div id="map" style="width: 99vw; height: 75vh;"></div>

	<!--Choropleth map data containers-->
	<div id="map_hover"></div>
	<div id="map_select"></div>


	<!--Visualization switching buttons-->
	<div id="btns">
		<button type="button" id="history-button" onclick="change_tab('HISTORY')" style="width:8vw;height:5vh;font-size:1vw;margin-bottom:2vh;">History</button>
		<button type="button" id="map-button" onclick="change_tab('MAP')" style="width:8vw;height:5vh;font-size:1vw;margin-bottom:2vh;">Map</button>
		<button type="button" id="details-button" onclick="change_tab('DETAILS')" style="width:8vw;height:5vh;font-size:1vw;">Details</button>
	</div>

	<!--Comparison criterion radio boxes-->
	<form id="measure_container">
		<b style="font-size:1vw;">MEASURE:</b>
		<!--<br></br>-->
	</form>

	<!--Comparison criterion radio boxes-->
	<form id="competition_container">
		<b style="font-size:1vw;">COMPETITION:</b>
		<!--<br></br>-->
	</form>

	<!--Visualization title (map excluded)-->
	<div id="title"></div>

	<!--Time slider-->
	<div id="slider_container">
		<div id="slider-range"></div>
		<div style="font-size:1vw;" id="slider_text">1872 - 2020</div>
	</div>

	<!--Flag slider-->
	<div class="flag-slider" id="js_flag_scroll"></div>
	<div class="wrap-input100">
		<input class="input100" type="text" id="search_bar" oninput="input_listener()" placeholder="Search for country...">
		<span class="focus-input100"></span>
	</div>


</body>
</html>
